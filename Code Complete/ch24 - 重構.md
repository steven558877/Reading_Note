# 重構
* 軟體演化的基本原則: 提升程式的內在品質
* 改善系統的方法之一是提升模組性
	* 對子程式定義完善並且良好命名，如果能將某段程式獨立出來變成另一個子程式來讓程式更清晰，那就把它獨立出來
## 重構的理由
* 重複的程式碼
* 冗長的子程式
	* 超過一個螢幕長度的子程式是必須被重構的
* 迴圈過長或是巢狀結構過深
* 內聚性太差的類別
* 類別介面沒有提供一致的抽象介面
* 擁有太多參數的函數
* 當對類別內的修改往往只改變了某個部分
	* 代表類別內部相關的部分可以在個別拆開成其他子程式
* 變化導致對多個類別的相同修改
	* 雖然難以完全解決這個問題，但是可以試著朝著只需要修改一個類別的目標前進
* 對繼承體系的相同修改
* 對 case 述句們需要做相同修改
	* 可以思考一下，是不是改用繼承會比較合適
* 成員函數使用其他類別的函數多過於自己類別的函數
	* 這個函數應該被歸類在其他類別
* 使用過多基礎的資料型態
	* 像是 Money 及 Temperature 都是 int 時，可能會被誤用，最好是建立各自的類別，並做一些對輸入資料的安全性檢察
* 某個類別無所事事
* 一系列傳遞流浪資料的子程式
	* 這個其實不是不行，只是要確定這個子程式想表達的抽象意義是在做這件事
* 中間人類別只去呼叫其他類別
	* 可能可以去掉這層
* 某個類別與其他類別過於緊密
	* 應該要做好良好的封裝，露出不想表達的抽象
* 子程式命名不當
* 資料成員被設為 public
* 某個類別只使用到基底類別的一小部分
	* 應該改成他擁有這個類別(has-a)，而非讓它是這個類別的衍生類別(is-a)
* 使用註解去解釋難懂的程式碼
	* 別做這種事
* 使用到全域變數
	* 想方法避掉使用全域變數
* 對子程式需要在呼叫前 setup，在結束前 teardown
	* 可能是表達了不對的抽象，書中的例子是一個函數要接收物件，但是傳遞物件前要賦予這個物件的成員一連串的值，或許應該改變抽象，讓函數接收一些值而非存有這些值的物件。
* 程式中存在未來可能會用到的程式碼
	* 超前設計的程式碼基本上高機率是錯的
	* 對未來需求有所準備的方法就是將當下的程式碼寫好
## 特定的重構
#### 資料層級的重構
* 使用 enum 替代 魔術數字
* 使變數的名字更清晰且傳遞更多訊息
* 將運算是行內化
	* 指的是不用額外變數儲存中間值，直接寫在運算式中
* 用函數代替運算式
* 引入中間變數，儲存運算式的值，但要有良好的命名
* 用多個單一用途的變數替代某個多用途的變數
	* 像是找方法替代 i, j, temp 等等用於多個地方的變數
* 將基礎資料類型轉化為類別
* 將擁有不同型別資料德陣列轉化為物件
* 用類別來代替傳統紀錄，讓他能對記錄集中處理。
#### 述句層級的重構
* 分解布林運算式
	* 用正確且精準的中間變數名稱來簡化複雜的布林運算，提高可讀性
* 合併條件述句(if, else等)中重複的程式碼片段
* 使用 break 或 return 替代額外的迴圈控制變數
* 在巢狀的條件數句中，一但知道答案就立刻 return，而不是去用一個返回值儲存，這會讓程式難以理解及分析
* 用多型來替代條件述句(尤其是重複的 case)
#### 子程式層級重構
* 擷取子程式的程式碼，轉化為單獨的子程式
* 將簡單且涵義不言自明的子程式 inline 化
* 將冗長的子程式轉成類別，並將子程式切分成多個類別內的函數
* 將查詢的操作從修改的操作中獨立出子程式
* 合併功能相似，只有參數不同的子程式，讓他們可以依照參數的種類做處裡。
* 將會根據參數而做不同事情的子程式拆分開來
* 在傳遞與物件相關的參數時思考這次的傳遞是要傳遞整個物件還是物件中的成員。
* 子程式返回一物件時，應當以最精確的類別去接他
#### 類別時做層級的重構
* 一個大型物件如果會被多次使用，請使用reference 去操作
* 小型物件則直接使用 copy by value
* 當衍生類別覆蓋虛擬函數的成員只是要讓他回傳這個衍生類別要用的特定值，此時在基底類別做一個通用程式碼去初始化會比較好
* 如果類別中某些程式碼只被特定的幾個 instance 所使用，將這些程式碼獨立出另一個衍生類別
* 如果兩個衍生類別有相似的程式碼，將它們合併並放入基底類別
#### 類別介面的重構
* 一個類別有多個功能的話，將他們拆分成多個類別
* 去除委派關係，如果A類別呼叫了B及C類別，但實際上應該是A呼叫B，B呼叫C，則要思考他們的介面是否合適。
* 去掉中間人，例如上述A可以直接呼叫C，不需要B，則要去除這個介面。
* 用委派代替繼承
	* 當一個類別擁有了另外一個類別，但是又想對該類別的介面有更多的控制權，可以的作法是在該類別的基底類別變成他的成員，讓要使用的淚ㄅㄧㄝ
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTE3ODA1MDk4MzAsLTMwNzQ4MjU1LC0zND
YxOTAwOCwxMDc2MDM0NDg4LC05MTg1MjEyOTcsLTg4OTI4NTQ4
NywtMTYyNzQ2NzM3OCwtMTAxNjY2NDQwMiwtMTIyMjE4MDQ5OC
wxMjA0NTc3NTgxLC0xNDI4MTEzMjUsMTkyMDQyNjU1XX0=
-->