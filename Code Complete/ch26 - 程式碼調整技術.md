# 程式碼調整技術
減少程式碼資源佔用的主要方法是透過對類別及資料結構的重新設計來實作。這章主要是示範一些方法讓你可以嘗試看看，而非一種放諸四海皆準的原則，活用這些方法讓程式碼更靈活。並且在修改完後要確認修改的方法相比於原始的程式碼真的有更快的速度。而在做調整之前必須確保這是有必要的，付出的成本和乎其代價，且在評估改變的效果時必須要量化，音ㄨ
## 邏輯
* 知道答案後停止判斷
* 按照出現頻率來調整順序
* 相似邏輯結構之間的效能比較
	* 例如 case 及 if-else
* 用查表代替複雜運算式
	* 如果表理解有難度，記得要補上說明
* 使用惰性求值
	* 當有需要時再去計算必要的數值
## 迴圈
* 將判斷往外提
	* 將迴圈內的判斷往迴圈外翻，變成先判斷再跑迴圈。但是這是一個與可讀性及可維護性的 trade-off，有需要時才這樣用。
* 合併
	* 將使用相同 index 的迴圈合併
* 展開
	* 小範圍的展開執行速度會比較快
* 盡可能減少迴圈內部的工作
	* 將能在迴圈外做的事情拉出迴圈外
* 哨兵值
	* 用一個變數當作目標，遇到就提早結束迴圈
* 把最忙的迴圈放在最內層
* 削減計算強度
	* 用加法代替乘法
## 資料變換
* 使用整數而非浮點數
* 陣列維度盡量小
	* 將二維、三維陣列轉換為一維陣列
* 盡可能減少陣列參考
	* 在外層迴圈先用一個變數接起內層會用到的陣列內容。
* 使用輔助索引
	* 添加額外的索引值提高對某種資料結構索引的效率
* 使用快取
	* 用變數儲存上次計算的結果，下次如果有人是相同的輸入就可以直接使用省掉計算
	* 關鍵在於讀取快取、建立未快取的資訊以及命中機率
	* 建立新元素的代價愈大，建立快取的效益就愈高
## 運算式
* 減少運算式的代價的方法
* 利用代數恆等式
	* ! (a | b) 會少 ( !a and !b ) 一個 ! 的計算
* 削弱運算強度
	* 用低廉成本的運算取代高成本的
	* 加法替代乘法
	* 乘法替代乘冪
	* 三角恆等式替換等價的三角函數
	* 用 long/int 替換 longlong 整數
	* 整數替換浮點數
	* 用單精度代替雙精度
	* 用位移操作取代乘2 或除2
* 使用 #define 將像是 log(2) 這種數值定義出來
* 如果運算式花費太長時間，可以定義出想要這個運算式的精確度需求，如果需求不高，則可以使用自訂函數縮減複雜度，例如 log(2) 我只需要整數值，不需要小數，就可以用一個函數去取得結果的整數部分舊好
## 子程式
* 短小的子程式更容易用低階語言重寫
* 把簡短的子程式用 `inline` 這種 C++ 的關鍵字可能可以省下一點時間，不過或許也有可能會降低效能
* 如果遇到效能瓶頸，應當用比當前更低階的程式語言去重寫，方法是:
	1. 用高階語言完成整個程式碼
	2. 進行測試，驗證完整性
	3. 如果測試後發現需要改善效能，則對程式碼進行分析，找出最耗時間的程式碼片段
	4. 把那些片段用低階語言重寫嘗試提升效能
* 要用低階語言，像是組語，重寫程式碼時，如果能找到能將高階語言，像是C++, 即時轉換成組合語言的編輯器是最好的，你可以以目前高階語言產生的低階語言當作基礎進行修改，並且使用高階語言當作其註解。
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTg4Mjg1MTg5OCwtNTg5ODYwNzM0LDEyOD
U0Mzc1MzIsNDE5NTUxODg2LC05NzEzNjc3MzUsMTQyMjQwMDA5
MywyMzQ1MjkzMzIsLTc0NTY0NDQ1LDEyMjMwODMxNTQsNjAyMT
U1NTk1LDQyMzE2Mjg1MSwxMDIzMzk1MzkxLC05ODk5NTY2MDMs
MTk2MTg5MTAxNiwtOTg4MzI5MjMzLDE0NjMwOTI3ODQsLTEzNj
U3NTU5NTYsLTEyMTA4NDYxOTcsNDkwMTcyNDM2LC00MTA5NTYy
NjldfQ==
-->