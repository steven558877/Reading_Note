# 表格驅動法

表格驅動法是一種設計模式，相對於邏輯述句(if, case等)，他是在表格尋找資訊而不是用邏輯判斷。凡事能透過邏輯述句來選擇的事物皆可使用表格驅動法選擇。
例如文字分類，使用邏輯述句會有大量的判斷，像是要判斷a-z、A-Z、0-9、特殊符號。使用表格驅動法只要先把這些文字預先儲存至表格，在用查表的方式就可達到一樣的功能。

使用表格驅動法要先解決的兩個問題:
1. 怎樣從表格查詢項目
2. 表格內要儲存甚麼資料

## 怎樣從表格查詢項目
當資料數小時沒什麼問題，但是當資料數量龐大時要如何有效的查表，有三種方法可以查表:
* 直接存取
* 索引存取
* 階梯存取

### 直接存取表
如其名，直接查表，替代複雜的邏輯判斷。無須繞複雜的圈子就能找到表格內的資訊，舉個例子:
```C++
int DayPerMonth = {31,28,31,30}
days = DayPerMonth[month-1];
```
書中提到一個例子，有一個氣象站會紀錄天氣資訊，每個資訊都有多個欄位。假如說這些欄位有26種資料型態，現在想要讓他們印出來，使用邏輯基礎法的話會式下面這樣:
```
如果還有資料要印 則:
	處理Header
	解析資料
	if 資料是A型態
		用A型態印出
	else 如果資料是B型態
		用B型態印出
		⋮
	else 如果資料是Z型態
		用Z型態印出
```

而透過表格驅動法的話會是

```
enum DataType {
	A,
	B,
	⋮
	Z
};

如果還有資料要印 則:
	處理Header
	解析資料
	根據資料類型查表
	用查表查到的資料類型印出資料
```
在`根據資料類型查表`這步驟，直覺的方式是使用向是C++中的case，更好的方式是建立一個Abstract Class，並且個資料型態繼承它並自訂行為。建立好後透過下列方式建立物件，在這個物件中儲存指標指向各類物件。
```C++
Abstract* dataTypePtr[dataTypeCount];
dataTypePtr[A] = new AField();
dataTypePtr[B] = new BField();
⋮
dataTypePtr[Z] = new ZField();

intdataTypeIndex = 0;
while(dataTypeIndex < dataTypeCount){
	dataType = DataSrc.dataType;
	dataName = DataSrc.dataName;
	dataTypePtr[dataType].print();
}
```
只要沒有改變欄位，這種寫法就不會需要去改while那個block的code，而增加資料型態的話只須完成繼承Abstract類別，對class進行修改並且將此資料型態加入dataTypePtr內即可。
### 索引存取表
==看不太懂這個表格在說什麼==

索引表是透過一個查詢索引陣列去紀錄查詢表本身的資料，這樣做有兩個好處:
第一、索引陣列的欄位大小比查詢表來得小，當要建立一個查詢用的表時，每個查詢值要對應到相應的欄位，並且存在著查詢值為空白的狀況，此時建立一個大部分是空白欄位的表時索引存取表相比直接紀錄的查詢表可以省很多空間。
第二、就算最後沒省到太多空間，你也可以對相同查詢表建立不同的索引存取表，例如對相同資料建立依據薪資、年齡等等的查詢表。
另外這種表格也較容易維護。

### 階梯存取表
建立一個有順序的表，在判斷時從表頭開始用一個迴圈循環，若滿足條件則繼續(或跳出)，直到表尾，然後在依據跳出時迴圈跑在表的拿個位置給定相對應的值。例如學生的原始成績要對應到A~F的評分就可以用這種方式，假設0 ~ 50分是F，51 ~ 65是D，則判斷時若成績小於50分則跳出迴圈、大於則繼續迴圈，接著判斷是否小於65，是就跳出迴圈，否則就繼續，如此重複操作值到跳出為止。
階梯法適合處理無規則的資料，並且只要修改階梯表就可以輕易地根據需求變化。但是使用時要注意端點，要處理乾淨。另外資料大時可考慮用二分法搜尋但也是要注意端點判斷。而當注重搜尋時間且有確切的Key值時，用索引存去表會是一個用空間換取時間的好選擇。

以上三種表格都是有用的，

## 表格內要儲存甚麼資料
儲存普通資料時沒問題，但如果查表要的結果是一些動作，則需要儲存一段程式碼，又或是指向該動作的函式指標。以上兩種皆會使表格內容變複雜。

<!--stackedit_data:
eyJoaXN0b3J5IjpbMTcxNjA5NTM0OSwtNDE0MzU4MzgzLDEwNj
c0MzkzOTAsLTQyODQxOTA0NywtNjg5OTI3ODA1LDE4MzQ3MjQ3
OTIsODkxNTgzNzI4LDEzNjAxOTQ2NjIsNDU3ODg1MTM4LDE0Mj
I5NzAwMzAsLTgyMTMzMDA2NSwtMTE1MzQxNjM2Nl19
-->